<!doctype html><html lang="en"><head><script type="text/javascript">console.log("Fired")</script><meta charset="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="apple-touch-icon" href="/logo.png"/><link rel="manifest" href="/manifest.json"/><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro&display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"/><meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8"/><link rel="fluid-icon" href="/logo.png" title="WhizSid"/><meta name="page-subject" content="WhizSid"/><meta name="theme-color" content="#151853"/><meta name="HandheldFriendly" content="true"/><title>WhizSid - Portfolio And Blog Posts</title><style>code,pre{white-space:pre-wrap!important}body{margin:0;padding:0}a:active,a:link,a:visited{color:inherit!important;text-decoration:none!important}.load{position:relative;margin:auto;width:100px;height:80px;margin-top:45vw;margin-top:calc(50vh - 100px)}.gear{position:absolute;z-index:-10;width:40px;height:40px;animation:spin 5s infinite}.two{left:40px;width:80px;height:80px;animation:spin-reverse 5s infinite}.three{top:45px;left:-10px;width:60px;height:60px}@keyframes spin{50%{transform:rotate(360deg)}}@keyframes spin-reverse{50%{transform:rotate(-360deg)}}.lil-circle{position:absolute;border-radius:50%;box-shadow:inset 0 0 10px 2px gray,0 0 50px #fff;width:100px;height:100px;opacity:.65}.blur-circle{position:absolute;top:-19px;left:-19px}.text{color:#d3d3d3;font-size:18px;font-family:"Open Sans",sans-serif;text-align:center;margin-top:60px}.loading-fixed{height:100vh;background:#fff;position:fixed;top:0;left:0;display:block;z-index:9999;width:100vw}</style><script>window.onload=function(){document.getElementsByClassName("loading-fixed")[0].remove()}</script><link href="/static/css/2.957bb6f1.chunk.css" rel="stylesheet"><meta property="og:title" content="WhizSid| Fixing Gaming Keyboard Backlight Issue - Arch Linux - Jedel K510"/><meta name="description" property="og:description" content="I recently bought a Jedel K510 gaming keyboard and found that keyboard
LEDs are not working on my Arch Linux laptop. And the LED toggle button is also not working. Because most of gaming keyboards are configured to working with only Windows or Mac OSs. In this post I am fixing this issue for my keyboard and discussing the way to fix for other gaming keyboards as well." /><meta property="keywords" content="Post, linux, blog, beginner, advanced, step by step" /><meta property="og:type" content="article"/><meta property="og:article:published_time" content="2021-11-08T05:20:54Z"/><meta property="og:article:modified_time" content="2021-11-08T05:21:11Z"/><meta name="author" content="Ramesh Kithsiri"/><meta property="og:article:author:first_name" content="Ramesh"/><meta property="og:article:author:last_name" content="Kithsiri"/><meta property="og:article:author:username" content="whizsid"/><meta property="fb:app_id" content="129537969147552"/><meta property="og:article:section" content="Software Engineering"/><meta property="og:article:tag" content="Post"/><meta property="og:article:tag" content="linux"/><meta property="og:image" content="https://github.com/whizsid/whizsid.github.io/raw/src/blog/images/gaming_keyboard_backlight.png"/><meta property="og:url" content="https://whizsid.github.io/blog/22/fixing-gaming-keyboard-backlight-issue---arch-linux---jedel-k510.html"/><body style="margin:0;background:#e8eaed"><div style="display:none" class="loading-fixed"><div class="load"><div class="gear one"><svg id="blue" viewbox="0 0 100 100" fill="#94DDFF"><path d="M97.6,55.7V44.3l-13.6-2.9c-0.8-3.3-2.1-6.4-3.9-9.3l7.6-11.7l-8-8L67.9,20c-2.9-1.7-6-3.1-9.3-3.9L55.7,2.4H44.3l-2.9,13.6      c-3.3,0.8-6.4,2.1-9.3,3.9l-11.7-7.6l-8,8L20,32.1c-1.7,2.9-3.1,6-3.9,9.3L2.4,44.3v11.4l13.6,2.9c0.8,3.3,2.1,6.4,3.9,9.3      l-7.6,11.7l8,8L32.1,80c2.9,1.7,6,3.1,9.3,3.9l2.9,13.6h11.4l2.9-13.6c3.3-0.8,6.4-2.1,9.3-3.9l11.7,7.6l8-8L80,67.9      c1.7-2.9,3.1-6,3.9-9.3L97.6,55.7z M50,65.6c-8.7,0-15.6-7-15.6-15.6s7-15.6,15.6-15.6s15.6,7,15.6,15.6S58.7,65.6,50,65.6z"></path></svg></div><div class="gear two"><svg id="pink" viewbox="0 0 100 100" fill="#FB8BB9"><path d="M97.6,55.7V44.3l-13.6-2.9c-0.8-3.3-2.1-6.4-3.9-9.3l7.6-11.7l-8-8L67.9,20c-2.9-1.7-6-3.1-9.3-3.9L55.7,2.4H44.3l-2.9,13.6      c-3.3,0.8-6.4,2.1-9.3,3.9l-11.7-7.6l-8,8L20,32.1c-1.7,2.9-3.1,6-3.9,9.3L2.4,44.3v11.4l13.6,2.9c0.8,3.3,2.1,6.4,3.9,9.3      l-7.6,11.7l8,8L32.1,80c2.9,1.7,6,3.1,9.3,3.9l2.9,13.6h11.4l2.9-13.6c3.3-0.8,6.4-2.1,9.3-3.9l11.7,7.6l8-8L80,67.9      c1.7-2.9,3.1-6,3.9-9.3L97.6,55.7z M50,65.6c-8.7,0-15.6-7-15.6-15.6s7-15.6,15.6-15.6s15.6,7,15.6,15.6S58.7,65.6,50,65.6z"></path></svg></div><div class="gear three"><svg id="yellow" viewbox="0 0 100 100" fill="#FFCD5C"><path d="M97.6,55.7V44.3l-13.6-2.9c-0.8-3.3-2.1-6.4-3.9-9.3l7.6-11.7l-8-8L67.9,20c-2.9-1.7-6-3.1-9.3-3.9L55.7,2.4H44.3l-2.9,13.6      c-3.3,0.8-6.4,2.1-9.3,3.9l-11.7-7.6l-8,8L20,32.1c-1.7,2.9-3.1,6-3.9,9.3L2.4,44.3v11.4l13.6,2.9c0.8,3.3,2.1,6.4,3.9,9.3      l-7.6,11.7l8,8L32.1,80c2.9,1.7,6,3.1,9.3,3.9l2.9,13.6h11.4l2.9-13.6c3.3-0.8,6.4-2.1,9.3-3.9l11.7,7.6l8-8L80,67.9      c1.7-2.9,3.1-6,3.9-9.3L97.6,55.7z M50,65.6c-8.7,0-15.6-7-15.6-15.6s7-15.6,15.6-15.6s15.6,7,15.6,15.6S58.7,65.6,50,65.6z"></path></svg></div><div class="lil-circle"></div><svg class="blur-circle"><filter id="blur"><fegaussianblur in="SourceGraphic" stddeviation="13"></fegaussianblur></filter><circle cx="70" cy="70" r="66" fill="transparent" stroke="white" stroke-width="40" filter="url(#blur)"></circle></svg></div><div class="text">loading</div></div><script type="text/javascript">document.querySelector(".loading-fixed").setAttribute("style","display: block")</script><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><h1 id="fixinggamingkeyboardbacklightissuearchlinuxjedelk510">Fixing Gaming Keyboard Backlight Issue - Arch Linux - Jedel K510</h1>
<p>I recently bought a Jedel K510 gaming keyboard and found that keyboard
LEDs are not working on my Arch Linux laptop. By default extra LEDS are
disabled on most of linux distributions for power saving purposes.
However I enabled it and found that LED toggle button is also not
working. But finally I managed to make all things work.</p>
<h2 id="turnonoffkeyboardledsbyterminal">Turn on/off keyboard LEDs by terminal</h2>
<p>Linux is allowing users to control all hardware items by a virtual
file system called <code>sys</code>. You can find out whats in the <code>sys</code> directory
by running <code>ls /sys</code> command. As per the <a href="https://www.kernel.org/doc/html/latest/leds/leds-class.html">official linux
doc</a> LED
controllers are in the <code>/sys/class/leds</code> and we can control LEDs by
running following commands.</p>
<pre><code># Turn on LEDS on a specific device
$ echo 1 &gt; /sys/class/leds/&lt;led-name&gt;/brightness

# Turn off LEDS on s specific device
$ echo 0 &gt; /sys/class/leds/&lt;led-name&gt;/brightness
</code></pre>
<p>But there are multiple LED names in the <code>/sys/class/leds/</code>
directory and we need to find the exact LED name for our device.</p>
<h2 id="findingtheledname">Finding the LED name</h2>
<p>To find out the LED name, first we should know the device id. To find
the device id we can use our friendly <code>lsusb</code> command.</p>
<pre><code>$ lsusb
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 005: ID 0bda:b00a Realtek Semiconductor Corp. Realtek Bluetooth 4.2 Adapter
Bus 001 Device 004: ID 04f2:b626 Chicony Electronics Co., Ltd HP TrueVision HD Camera
Bus 001 Device 003: ID 2a7a:9587  CASUE USB KB
Bus 001 Device 002: ID 1bcf:08a0 Sunplus Innovation Technology Inc. Gaming mouse [Philips SPK9304]
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</code></pre>
<p>In this example my device id is <code>2a7a:9587</code> which vendor id is <code>2a7a</code>
and the product id is <code>9587</code>.</p>
<p>Now we can find the LED name by running following command in your
bash/sh terminal.</p>
<pre><code>$ for led in $(ls -1 /sys/class/leds/); do echo "LED Name:- $led Device Id:- $(cat /sys/class/leds/$led/device/id/vendor):$(cat /sys/class/leds/$led/device/id/product)"; done | grep 2a7a:9587
</code></pre>
<p>Replace <code>2a7a:9587</code> with your device id. Now you can see an output like
below.</p>
<pre><code>LED Name:- input8::capslock Device Id:- 2a7a:9587
LED Name:- input8::compose Device Id:- 2a7a:9587
LED Name:- input8::kana Device Id:- 2a7a:9587
LED Name:- input8::numlock Device Id:- 2a7a:9587
LED Name:- input8::scrolllock Device Id:- 2a7a:9587
</code></pre>
<p>I know in Jedel K510 keyboard, all LEDs mapped to Scroll Lock button.
Because it mentioned in the keyboard casing. If you are trying with
another keyboard, Run bellow command for each LED names and check which
LED name is making your LEDs turn on.</p>
<pre><code>$ su # Logging as root user
$ echo 1 &gt; /sys/class/leds/&lt;led-name&gt;/brightness
</code></pre>
<h2 id="isthislednameisconstant">Is this LED name is constant?</h2>
<p>For some keyboards this LED name is permanent and not
for some keyboards. You can run below command after re-plug your
keyboard to check the weather the LED name changed.</p>
<pre><code>$ for led in $(ls -1 /sys/class/leds/); do echo "LED Name:- $led Device Id:- $(cat /sys/class/leds/$led/device/id/vendor):$(cat /sys/class/leds/$led/device/id/product)"; done | grep 2a7a:9587
</code></pre>
<h2 id="scripttotogglekeyboardbacklight">Script to toggle keyboard backlight</h2>
<p>I made a simple script to toggle keyboard backlight when we pass
vendor id and product id obtained by <code>lsusb</code> command. Change <code>VENDOR</code>,
<code>PRODUCT</code> variables with your vendor id and product id. And also change
<code>BUTTON</code> with your LED name suffix.</p>
<pre><code class="sh language-sh"># ~/.local/bin/kbb.sh

#!/usr/bin/bash

VENDOR=2a7a
PRODUCT=9587

BUTTON="scrolllock"
MODE=$1

for led in $(ls -1 /sys/class/leds/)
do
    productId=$(cat /sys/class/leds/$led/device/id/product)
    vendorId=$(cat /sys/class/leds/$led/device/id/vendor)
    if [ "$VENDOR:$PRODUCT" = "$vendorId:$productId" -a "${led##*::}" = "$BUTTON" ]
    then
        if [ "$#" -ne 1 ]; then
            if [ "0" = $(cat /sys/class/leds/$led/brightness) ]; then
                MODE="1"
            else
                MODE="0"
            fi
        fi

        echo "MODE" &gt; /sys/class/leds/$led/brightness
    fi
done
</code></pre>
<p>I made this script for keyboards with dynamic LED names. If your LED
name is a constant, remove additional <code>for</code> loops and make it simple
like below. Replace <code>LEDNAME</code> variable with the name of the LED.</p>
<pre><code class="sh language-sh"># ~/.local/bin/kbb.sh

#!/usr/bin/bash

MODE=$1
LEDNAME="asuskb_backlight"

if [ "$#" -ne 1 ]; then
    if [ "0" = $(cat /sys/class/leds/$LEDNAME/brightness) ]; then
        MODE="1"
    else
        MODE="0"
    fi
fi

echo "MODE" &gt; /sys/class/leds/$LEDNAME/brightness
</code></pre>
<p>Now you can run the script like bellow.</p>
<pre><code># Giving executable permissions to file
$ chmod +x ~/.local/bin/kbb.sh

# Turn on LEDs
$ sudo ~/.local/bin/kbb.sh 1

# Turn off LEDs
$ sudo ~/.local/bin/kbb.sh 0

# Toggle LEDs
$ sudo ~/.local/bin/kbb.sh
</code></pre>
<h2 id="addingthescripttorunonstartup">Adding the script to run on startup</h2>
<p>By default non-root users do not have permission to edit the <code>/sys/class</code>
files. So we have to use <code>sudo</code> when running the command in terminal and
the <code>sudo</code> will ask for the password. But in auto-scripts, we do not have
a tty to interact with commands. So we have to avoid the interactions
when using <code>sudo</code> command. We can achieve this by adding a rule to
<code>sudoers</code> file.</p>
<p>Another issue is we can not redirect <code>echo</code> output to a file when using
<code>sudo</code> command. So we have to use <code>tee</code> command with <code>sudo</code> to write
output to <code>/sys</code> files.</p>
<pre><code># /etc/sudoers

# ...

ALL ALL = (ALL) NOPASSWD: /usr/bin/tee /sys/class/leds/*/brightness
</code></pre>
<p>After adding the above rule <code>sudo</code> command will not asking for a
password anymore when controlling LEDs.</p>
<p>Now we have to change our script to use <code>tee</code> instead echo.</p>
<pre><code class="sh language-sh">$ ~/.local/bin/kbb.sh

# Change this

echo "MODE" &gt; /sys/class/leds/$led/brightness
# to
echo "$MODE" | sudo /usr/bin/tee "/sys/class/leds/$device/brightness"
</code></pre>
<p>Now check our change by running the script without <code>sudo</code></p>
<pre><code>$ ~/.local/bin/kbb.sh
</code></pre>
<p>You can see your keyboard LEDs toggled. Next add the command to your
<code>.profile</code> file to run on startup</p>
<pre><code># ~/.profile

/home/ramesh/.local/bin/kbb.sh
</code></pre>
<h2 id="bindingscrolllockkeyxorgi3only">Binding Scroll Lock key (xorg + i3 only)</h2>
<p>To bind the scroll lock key to our script, we have to know the key id of
the Scroll Lock key. First run below command and find the master id of
your keyboard.</p>
<pre><code>$ xinput list
⎡ Virtual core pointer                        id=2    [master pointer  (3)]
⎜   ↳ Virtual core XTEST pointer                  id=4    [slave  pointer  (2)]
⎜   ↳ HID 1bcf:08a0 Mouse                         id=8    [slave  pointer  (2)]
⎜   ↳ HID 1bcf:08a0 Keyboard                      id=9    [slave  pointer  (2)]
⎜   ↳ SynPS/2 Synaptics TouchPad                  id=16   [slave  pointer  (2)]
⎣ Virtual core keyboard                       id=3    [master keyboard (2)]
    ↳ Virtual core XTEST keyboard                 id=5    [slave  keyboard (3)]
    ↳ Power Button                                id=6    [slave  keyboard (3)]
    ↳ Video Bus                                   id=7    [slave  keyboard (3)]
    ↳ HID 1bcf:08a0                               id=10   [slave  keyboard (3)]
    ↳ CASUE USB KB                                id=11   [slave  keyboard (3)]
    ↳ CASUE USB KB System Control                 id=12   [slave  keyboard (3)]
    ↳ CASUE USB KB Consumer Control               id=13   [slave  keyboard (3)]
    ↳ HP TrueVision HD Camera: HP Tru             id=14   [slave  keyboard (3)]
    ↳ AT Translated Set 2 keyboard                id=15   [slave  keyboard (3)]
    ↳ Wireless hotkeys                            id=17   [slave  keyboard (3)]
    ↳ HP WMI hotkeys                              id=18   [slave  keyboard (3)]
    ↳ HID 1bcf:08a0 Keyboard                      id=19   [slave  keyboard (3)]
</code></pre>
<p>In this example, the master id of my keyboard is 11. Then run the below
command and press Scroll Lock key while running it. Replace <code>11</code> with
your master id.</p>
<pre><code>$ xinput test 11 
key release 36 
key press   78 
key release 78 
key press   78 
key release 78 
key press   78 
key release 78 
key press   37 
key press   54 
^C
</code></pre>
<p>In this example the key id is <code>78</code> and it is the common key id of the
scroll key for every keyboard.</p>
<p>Now bind our script to the Scroll Key by editing i3 configuration file.</p>
<pre><code># ~/.config/i3/config

# Keyboard backlight
bindcode 78 exec --no-startup-id /home/ramesh/.local/bin/kbb.sh
</code></pre>
<p>Now reload the i3 configurations by pressing <code>Cmd+Shift+R</code>.</p>
<p>Check it by pressing the Scroll Lock key. Your keyboard backlight will be
toggled.</p></div><script>!function(e){function r(r){for(var n,l,f=r[0],i=r[1],p=r[2],c=0,s=[];c<f.length;c++)l=f[c],Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&s.push(o[l][0]),o[l]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);for(a&&a(r);s.length;)s.shift()();return u.push.apply(u,p||[]),t()}function t(){for(var e,r=0;r<u.length;r++){for(var t=u[r],n=!0,f=1;f<t.length;f++){var i=t[f];0!==o[i]&&(n=!1)}n&&(u.splice(r--,1),e=l(l.s=t[0]))}return e}var n={},o={1:0},u=[];function l(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,l),t.l=!0,t.exports}l.m=e,l.c=n,l.d=function(e,r,t){l.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,r){if(1&r&&(e=l(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(l.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)l.d(t,n,function(r){return e[r]}.bind(null,n));return t},l.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(r,"a",r),r},l.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},l.p="/";var f=this.webpackJsonpportfolio=this.webpackJsonpportfolio||[],i=f.push.bind(f);f.push=r,f=f.slice();for(var p=0;p<f.length;p++)r(f[p]);var a=i;t()}([])</script><script src="/static/js/2.ac8b28ac.chunk.js"></script><script src="/static/js/main.82d91667.chunk.js"></script></body></html>